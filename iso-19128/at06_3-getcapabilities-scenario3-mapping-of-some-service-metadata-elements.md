# Scenario 3 - Mapping of service metadata elements to the capabilities section

**Purpose**: Test that the capabilities section of the View Service contains the Service metadata elements in accordance with [Table 3b](#table3b).

**Prerequisites**

These tests only applies to [Scenario 3](./README.md#scenarios). Otherwise, the test case is skipped.

**Test method**

* Send a getCapabilities request to the service endpoint. Into the response:

  * Check that exactly one [Title](#title) element is provided and it is not empty.

  * Check that exactly one [Abstract](#abstract) element is provided and it is not empty.
  
  * Check that, if there is a [MetadataURL](#metadataURL) element for a layer:

    * the [OnlineResource](#onlineResource) element has an 'xlink:href' attribute, its content is not empty and one of the following checks is passed:

      * a valid response is returned sending a HTTP/GET request to the GetRecorById of the Discovery Service, .

      * a direct link is provided to the ISO19139 metadata document.
      
    * otherwise, check manually that "_if linkage to data sets on which the service operates are available_" the [MetadataURL](#metadataURL) element is mandatory.
  
  * Check that at least one [Keyword](#mandatoryKeyword) element with a value from the "[Classification of Spatial data Services](https://inspire.ec.europa.eu/metadata-codelist/SpatialDataServiceCategory)" codelist is provided.
    
  * Check manually that the Geographic Bounding Box is provided in the dataset metadata. It is mandatory "_if the service has an explicit geographic extent._".

  * Check if a Temporal Reference is provided through the [updateSequence](#updateSequence) attribute and that the date provided is formatted in YYYY-MM-DD format,
    
    * otherwise, manual check that the Temporal Reference is mapped to the Temporal Reference of the dataset metadata, in order of a date of type publication, revision creation.

  * Check if the declaration of conformity against the Commission Regulation (EC) No 976/2009 of 19 October 2009 implementing Directive 2007/2/EC of the European Parliament and of the Council as regards the Network Services - URI: http://data.europa.eu/eli/reg/2009/976 is provide through a dedicated [Conformity Keyword](#conformity),
  
    * otherwise, check manually that the lack of the keyword means that the degree of conformity of the service is considered as "non-conformant" or "not evaluated".

  * Check that at least one [Fees](#Fees) element is provided defining the conditions for access and use. If no conditions apply to the access and use of the resource, "no conditions apply" shall be used. If conditions are unknown "conditions unknown" shall be used.

  * Check that at least one [AccessConstraints](#accessConstraints) element is provided.
  
  * Check that the Responsible Organisation is provided through the [ContactOrganization](#ContactOrganization) element and that the Responsible Party role is provided through the [ContactPosition](#ContactPosition) element with one of the values of code list [Responsible party role](https://inspire.ec.europa.eu/metadata-codelist/ResponsiblePartyRole).

  * Check if the Metadata Date is provided through the [updateSequence](#updateSequence) attribute and that the date provided is formatted in YYYY-MM-DD format,
    
    * otherwise, manual check that the Metadata Date is mapped to the Temporal Reference of the dataset metadata, in order of a date of type publication, revision creation.

  


Table 3b <a name="table3b"></a>: Mapping between INSPIRE metadata elements and [ISO 19128] WMS elements without the use of extended capabilities.

| INSPIRE Metadata element<br>(***M***andatory - ***C***onditional) | WMS 1.3 Capabilities without ExtendedCapabilities                                                                                                                     | Fallback                                                                                                                                                                                                                             | Multiplicity | Condition                                                                         | Specific TG requirement (if present)                                                                                                                                                                                            | Check type                                                                                       |
| ----------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------ | --------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ |
| Resource Title (_M_)                                    | wms:Title                                                                                                                                                                       |                                                                                                                                                                                                                                      | 1            |                                                                                   |                                                                                                                                                                                                                                 | Automatic                                                                                        |
| Resource Abstract (_M_)                                 | wms:Abstract                                                                                                                                                                    |                                                                                                                                                                                                                                      | 1            |                                                                                   |                                                                                                                                                                                                                                 | Automatic                                                                                        |
| Resource Type (_M_)                                     | \-                                                                                                                                                                              | Is by default "service"                                                                                                                                                                                                              | 1            |                                                                                   | Requirement 11: the value shall be 'service'.                                                                                                                                                                                   | \-                                                                                           |
| Resource Locator (_C_)                                  | \-                                                                                                                                                                              | Resource Locator of the data set                                                                                                                                                                                                     | 0..\*        | Mandatory if linkage to the service is available.                                 |                                                                                                                                                                                                                                 | Automatic (Check performed on the dataset metadata by CC8)                                          |
| Coupled Resource (_C_)                                  | wms:MetadataURL (per layer)                                                                                                                                                     |                                                                                                                                                                                                                                      | 0..\*        | Mandatory if linkage to data sets on which the service operates are available.    | Requirement 14: the value shall be a URL that allows access to a metadata record.                                                                                                                                               | Automatic + Manual                                                                               |
| Spatial Data Service Type (_M_)                         | \-                                                                                                                                                                              | In a ISO/TS 19139:2007 metadata record dataset:<br>gmd:MD_Metadata/gmd:distributionInfo/gmd:MD_Distribution/gmd:transferOptions<br>/gmd:MD_DigitalTransferOptions/gmd:onLine/gmd:CI_OnlineResource/gmd:applicationProfile                   | 1            |                                                                                   | Requirement 15:  the value shall be 'view'.                                                                                                                                                                                     | Automatic (Check performed on the dataset metadata by CC8)                                        |
| Keyword (_M_)                                           | wms:Keyword and wms:Keyword/@vocabulary                                                                                                                                         |                                                                                                                                                                                                                                      | 1..\*        |                                                                                   | Requirement 16: at least one keyword from the Classification of spatial data services shall be provided.                                                                                                                        | Automatic                                                                                        |
| Geographic Bounding Box (_C_)                           | \-                                                                                                                                                                              | Geographic Bounding Box of the data set                                                                                                                                                                                              | 0..\*        | Mandatory for services with an explicit geographic extent.                        |                                                                                                                                                                                                                                 | Manual                                                                                           |
| Temporal Reference (_M_)                                | updateSequence attribute                                                                                                                                                        | If in the optional<br>updateSequence attribute a timestamp value is not present, the<br>Temporal Reference is mapped to the Temporal Reference of the dataset<br>metadata, in order of a date of type publication,revision creation. | 1..\*        |                                                                                   | Requirement 20: one of the following dates shall be provided: date of publication, date of last revision, or the date of creation. Date of last revision is preferred. The date shall be expressed in conformity with ISO 8601. | Automatic + Manual                                                                               |
| Spatial Resolution (_C_)                                | \-                                                                                                                                                                              | Spatial Resolution of the data set                                                                                                                                                                                                   | 0..\*        | Mandatory when there is a restriction on the spatial resolution for this service. |                                                                                                                                                                                                                                 | Manual                                                                                           |
| Conformity (_M_)                                        | wms:KeywordList/wms:Keyword; use a wms:Keyword<br>element for each specification against which the service is conformant,<br>included within an specific wms:KeywordList group. |                                                                                                                                                                                                                                      | 1..\*        |                                                                                   |                                                                                                                                                                                                                                 | Automatic + Manual                                                                                       |
| Conditions for Access and Use (_M_)                     | wms:Fees                                                                                                                                                                        |                                                                                                                                                                                                                                      | 1..\*        |                                                                                   | Requirement 24: If no conditions apply to the access and use of the resource, the value "no conditions apply" shall be used. If conditions are unknown "conditions unknown" shall be used.                                      | Automatic                                                                                        |
| Limitations on Public Access (_M_)                      | wms:AccessConstraints                                                                                                                                                           |                                                                                                                                                                                                                                      | 1..\*        |                                                                                   |                                                                                                                                                                                                                                 | Automatic                                                                                        |
| Responsible Organisation (_M_)                          | wms:ContactInformation/wms:ContactPersonPrimary/wms:ContactOrganization<br>and wms:ContactInformation/wms:ContactPosition                                                       |                                                                                                                                                                                                                                      | 1..\*        |                                                                                   | Requirement 26: The value domain of the Responsible Party role shall be one of the values of code list Responsible party role.                                                                                                  | Automatic                                                                                        |
| Metadata Point of Contact (_M_)                         | wms:ContactInformation/wms:ContactPersonPrimary/wms:ContactOrganization<br>and wms:ContactInformation/wms:ContactElectronicMailAddress                                          |                                                                                                                                                                                                                                      | 1..\*        |                                                                                   | Requirement 27: The role of the metadata point of contact shall be "pointOfContact".                                                                                                                                            | Manual (the Metadata Point Of Contact is assumed to be the same as the Responsible Organisation) |
| Metadata Date (_M_)                                     | updateSequence attribute                                                                                                                                                        | If in the optional<br>updateSequence attribute a timestamp value is not present, the<br>Metadata Date is mapped to the Temporal reference of the dataset<br>metadata, in order of a date of type publication,revision creation.      | 1            |                                                                                   | Requirement 29: The date shall be expressed in conformity with the [INS MD], meaning it shall be expressed in conformity with ISO 8601.                                                                                         | Automatic + Manual                                                                               |
| Metadata Language (_M_)                                 | \-                                                                                                                                                                              | Metadata Language of the data set                                                                                                                                                                                                    | 1            |                                                                                   |                                                                                                                                                                                                                                 | \-                                                                                           |



**Reference(s)**:
* [TG VS](./README.md#ref_TG_VS), Chapter 4.2.3.3.1, Requirement 6 - Section 2, Requirement 11
* [INS MD](./README.md#ref_INS_MD), Part C - Table 2; Classification of Spatial data Services, Part D.4

**Test type**: Automated + Manual

**Notes**

The mapping of the INSPIRE metadata elements of the data set is available in the TG Metadata.

As stated by the INSPIRE Metadata Technical Guidance [INS MDTG], it is not possible to express the restriction of a service concerning the spatial resolution in the current version of [ISO 19119]. While this issue is being addressed by the standardisation community, spatial resolution restrictions for services shall be written in the Abstract as mandated by the Metadata Technical Guidance [INS MDTG]. Spatial Resolution restrictions at service metadata level shall be declaratively described in the wms:Abstract element.

**Contextual XPath references**

The namespace prefixes used as described in [README.md](./README.md#namespaces).
Related XPaths are provided in the table above.

Abbreviation                                               |  XPath expression (relative to /wms:WMS_Capabilities)
---------------------------------------------------------- | -------------------------------------------------------------------------
Resource Title <a name="title"></a>                              | wms:Service/wms:Title
Resource Abstract <a name="abstract"></a>                        | wms:Service/wms:Abstract
MetadataURL <a name="metadataURL"></a>                           | wms:Capability/\*/wms:Layer/MetadataURL
OnlineResource <a name="onlineResource"></a>                     | wms:Capability/\*/wms:Layer/MetadataURL/OnlineResource
Keyword <a name="mandatoryKeyword"></a>                          | wms:Service/wms:KeywordList/wms:Keyword
updateSequence <a name="updateSequence"></a>                     | @updateSequence
Conformity Keyword<a name="conformity"></a>                      | wms:Service/wms:KeywordList/wms:Keyword (vocabulary="http://data.europa.eu/eli"; value=http://data.europa.eu/eli/reg/2009/976)
Fees <a name="Fees"></a>                                         | wms:Service/wms:Fees
Access Constraints <a name="accessConstraints"></a>              | wms:Service/wms:AccessConstraints
ContactOrganization <a name="ContactOrganization"></a>           | wms:Service/wms:ContactInformation/wms:ContactPersonPrimary/wms:ContactOrganization
ContactPosition <a name="ContactPosition"></a>                   | wms:Service/wms:ContactInformation/wms:ContactPosition